# Windows 应用图标显示问题解决方案

## 问题说明
重新安装应用后，Windows 可能仍显示旧图标或默认图标。这是因为 Windows 会缓存应用程序图标。

## 已完成的修复
1. ✅ 将错误的 PNG 格式的 icon.ico 转换为真正的 ICO 格式
2. ✅ 生成多尺寸 ICO 文件（256x256, 128x128, 64x64, 48x48, 32x32, 16x16）
3. ✅ 重新构建应用程序，图标已正确嵌入

## 解决方案：清理 Windows 图标缓存

### 方法1：使用提供的批处理脚本（推荐）

1. 关闭所有正在运行的 Pyra 实例
2. 卸载当前安装的 Pyra 应用
3. 运行项目根目录下的 `clear-icon-cache.bat` 脚本
4. 重新安装新构建的安装包：
   - `src-tauri/target/release/bundle/nsis/Pyra_0.1.0_x64-setup.exe` (NSIS 安装程序)
   - 或 `src-tauri/target/release/bundle/msi/Pyra_0.1.0_x64_zh-CN.msi` (中文 MSI)
   - 或 `src-tauri/target/release/bundle/msi/Pyra_0.1.0_x64_en-US.msi` (英文 MSI)

### 方法2：手动清理图标缓存

如果脚本无法运行，可以手动操作：

1. 关闭所有 Pyra 实例并卸载应用
2. 打开任务管理器（Ctrl+Shift+Esc）
3. 找到"Windows 资源管理器"进程，右键选择"结束任务"
4. 点击任务管理器菜单"文件" > "运行新任务"
5. 输入：`%localappdata%\Microsoft\Windows\Explorer` 并回车
6. 删除以下文件（如果存在）：
   - IconCache.db
   - iconcache_*.db
   - thumbcache_*.db
7. 在任务管理器中点击"文件" > "运行新任务"，输入 `explorer.exe` 重启资源管理器
8. 重新安装 Pyra

### 方法3：使用 PowerShell 命令

在管理员权限的 PowerShell 中运行：

```powershell
# 停止 Explorer
Stop-Process -Name explorer -Force

# 删除图标缓存
Remove-Item "$env:LOCALAPPDATA\Microsoft\Windows\Explorer\IconCache.db" -Force -ErrorAction SilentlyContinue
Remove-Item "$env:LOCALAPPDATA\Microsoft\Windows\Explorer\iconcache_*.db" -Force -ErrorAction SilentlyContinue
Remove-Item "$env:LOCALAPPDATA\Microsoft\Windows\Explorer\thumbcache_*.db" -Force -ErrorAction SilentlyContinue

# 重启 Explorer
Start-Process explorer.exe
```

## 验证图标是否正确

安装完成后：
1. 检查桌面快捷方式图标
2. 检查开始菜单中的应用图标
3. 检查任务栏中运行时的图标
4. 检查应用窗口左上角的图标

## 如果问题仍然存在

如果清理缓存后图标仍不显示：

1. 重启计算机
2. 确保完全卸载旧版本
3. 使用管理员权限运行安装程序
4. 检查 `src-tauri/icons/icon.ico` 文件是否正确（应为 149KB 的 ICO 格式文件）

## 技术细节

- 图标文件位置：`src-tauri/icons/icon.ico`
- 图标格式：ICO（包含 6 种尺寸）
- 配置文件：`src-tauri/tauri.conf.json`
- 安装包位置：`src-tauri/target/release/bundle/`

## 源图标文件

高分辨率源文件保存在：`src-tauri/icons/icon.png` (1266x1227 像素)
如需重新生成 ICO，可使用：

```bash
python -c "from PIL import Image; img = Image.open('src-tauri/icons/icon.png'); img.save('src-tauri/icons/icon.ico', format='ICO', sizes=[(256,256), (128,128), (64,64), (48,48), (32,32), (16,16)])"
```
